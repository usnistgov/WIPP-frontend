<div class="row" style="margin-top: 2%; margin-bottom: 2%">
  <div class="col-md-6">
    <h3 style="display: inline">Workflow detail</h3>
    <button *ngIf="workflow.status === 'CREATED'"
            class="btn btn-outline-dark"
            style="margin-left: 2%; margin-top: -1%"
            [disabled]="jobs.length < 1"
            (click)="submitWorkflow()">
      <i class="fas fa-arrow-alt-circle-right" style="margin-right: 10px">
        <p style="margin-left: 10px; display: inline; font-family: 'Roboto', sans-serif ; font-weight: normal">Submit
          workflow
        </p>
      </i>
    </button>
    <button
      *ngIf="workflow.generatedName"
      class="btn btn-outline-dark"
      style="margin-left: 2%; margin-top: -1%; display: inline"
    >
      <i class="fas fa-sitemap" style="display: inline;"> </i>
      <a class="nav-link"
         href={{argoUiLink}}
         target="_blank"
         style="color:inherit; text-decoration: none; display: inline"
         [ngbTooltip]="plotTipContent"
      >
        <p style=" display: inline; font-family: 'Roboto', sans-serif ; font-weight: normal">
          Monitor in Argo
        </p>
      </a>
    </button>
  </div>
</div>

<ngx-spinner></ngx-spinner>

<div style="margin-top: 20px">
  <div class="row">
    <div class="col-md-12"><b>Name:</b> {{workflow.name}}</div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <b>Status:</b> {{workflow.status}}
      <span *ngIf="workflow.status === 'ERROR' && workflow.errorMessage"
            ngbTooltip={{workflow.errorMessage}}
            placement="right"
            aria-hidden="true"><i class="far fa-question-circle"></i>
          </span>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12"><b>Creation Date:</b> {{workflow.creationDate | date}}</div>
  </div>

  <div [hidden]="workflow.status!='CREATED'" style="margin-top: 30px; margin-bottom: 40px">
    <h4 style="margin-bottom: 20px">Workflow tasks</h4>
    <div class="row">
      <div class="col-md-2">
        <button class="btn btn-outline-dark" (click)="open(addStepModal)"
                [disabled]="!workflow.name">
          <i class="fas fa-plus-circle" style="margin-right: 10px">
            <p style="margin-left: 10px; display: inline; font-family: 'Roboto', sans-serif ; font-weight: normal">Add
              task</p>
          </i>
        </button>
      </div>
    </div>
  </div>
</div>
<div class="row" style="border: dotted 2px lightgray ; height: 500px; margin-top: 30px" [hidden]="jobs.length<1">
  <div class="col-md-1">
    <button style="margin-top: 20px; margin-left: 20px;" class="btn btn-outline-dark" (click)="centerAndFitGraph()">
      Center Graph
    </button>
  </div>
  <div class="col-md-11" style="margin-top: 20px">


    <ngx-graph
      *ngIf="jobs.length > 0"
      class="chart-container"
      [links]=links
      [nodes]=nodes
      [update$]="update$"

      [enableZoom]="true"
      [draggingEnabled]="false"
      [panningEnabled]="true"
      [zoomToFit$]="zoomToFit$"
      [center$]="center$"
    >
      <ng-template #nodeTemplate let-node>
        <svg:g class="node" (click)="displayJobModal(node.id)"
        >
          <svg:rect
            [attr.width]="node.dimension.width"
            [attr.height]="node.dimension.height"
            [attr.fill]="node.data.color"
          />
          <svg:text alignment-baseline="central" [attr.x]="10" [attr.y]="node.dimension.height / 2">
            {{node.label}}
          </svg:text>
        </svg:g>
      </ng-template>

    </ngx-graph>

  </div>
</div>

<ng-template #addStepModal let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title">New Task</h4>
    <button type="button" class="close" aria-label="Close" (click)="d()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="form-group">
      <label for="pluginName">Plugin:</label>
      <select id="pluginName" class="form-control" #pluginName [(ngModel)]="selectedSchema">
        <option *ngFor="let plugin of pluginList" [ngValue]="plugin">{{ plugin.name }} {{ plugin.version }}</option>
      </select>
    </div>
    <sf-form [schema]="selectedSchema" [bindings]="selectedSchema.fieldBindings" #jsonForm></sf-form>
  </div>
  <div class="modal-footer">
    <button type="submit" class="btn btn-outline-dark" (click)="c(jsonForm.rootProperty.value)">
      <i class="fas fa-plus-circle" style="margin-right: 10px">
        <p style="margin-left: 10px; display: inline; font-family: 'Roboto', sans-serif ; font-weight: normal">Add
          task</p>
      </i>
    </button>
  </div>
</ng-template>

<ng-template #plotTipContent> See in Argo dashboard
  <span
    aria-hidden="true"><i class="fas fa-external-link-alt"></i></span>
</ng-template>
